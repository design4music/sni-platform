You're absolutely right. Let me be much more direct and structured. Here's the concrete plan in a table format.

### Proposed Processing Steps & Integration Points

| Step | Where It Fits in Pipeline | What It Does | How It Works |
| :--- | :--- | :--- | :--- |
| **1. Enhanced EF Seed Creation** | **P3 (Generate EFs)** - Replaces the current LLM call for `primary_theater`. | Creates the initial Event Family "seed" with a robust, data-driven theater and a high-quality `strategic_purpose`. | 1. **Mechanical Bucketing:** Current cosine similarity clustering (P3_BUCKET, P3_CLUSTER).<br>2. **LLM Analysis (Enhanced Prompt):** For each cluster, the LLM now:<br>   - Generates `title`, `summary`, `event_type` (from your fixed list).<br>   - **Generates `strategic_purpose`** (a one-sentence core narrative).<br>   - **Does NOT** choose `primary_theater` from a short list.<br>3. **Dynamic Theater Assignment:** A new mechanical step uses the cluster's most frequent **countries/regions from `entities`** (enriched by P2) to assign the theater. |
| **2. Dynamic Theater Assignment** | **P3 (Generate EFs)** - New step after P3_LLM, before P3_EF_KEY. | Determines the EF's theater based on actual entity data, not an LLM's choice from a limited list. | 1. Analyze all `entities` in the cluster's titles.<br>2. Filter for geopolitical entities (countries, regions like "Gaza").<br>3. Select the most frequent one(s) as the `primary_theater`.<br>4. **Generate `ef_key`** as `SHA256(theater + event_type)`. |
| **3. Thematic Validation & Refinement** | **NEW: P3.5 (Continuous Process)** - Runs after P3/P4, processes new titles. | Uses micro-prompts to thematically validate EF members and decide if new titles belong to existing EFs. | 1. **Queue:** Get new titles (`gate_keep=true`, `event_family_id IS NULL`).<br>2. **Pre-Filter:** Find candidate EFs with matching `event_type`.<br>3. **Micro-Prompt:** For each candidate, ask LLM: "Does this headline fit the strategic purpose `[EF.strategic_purpose]`? YES/NO."<br>4. **Route:** On YES, assign title to EF. On all NOs, leave it for the next P3 batch to form a new EF seed. |

---

### Summary of the Core Idea

Yes, you've got it. The core idea is a two-stage process:

1.  **Mechanical EF Seed Creation (P3):** We use fast, deterministic methods (cosine clustering, entity frequency) to create a solid first draft of an Event Family. The only AI here is a **single, powerful LLM call** to define the `strategic_purpose` and other fields for the *entire cluster*.

2.  **AI-Powered Thematic Management (P3.5):** We use cheap, deterministic **micro-prompts** (YES/NO questions) to manage the Event Family's lifecycle. This is for:
    *   **Validating** that titles in the seed truly belong.
    *   **Adding new titles** to the correct EF across different processing batches.
    *   (Potentially) **Splitting** an EF if micro-prompts show a title doesn't fit, indicating the seed was too broad.

This gives you the best of both worlds: the efficiency and stability of mechanical clustering for the heavy lifting, and the nuanced intelligence of AI for the final, critical decisions on thematic coherence.